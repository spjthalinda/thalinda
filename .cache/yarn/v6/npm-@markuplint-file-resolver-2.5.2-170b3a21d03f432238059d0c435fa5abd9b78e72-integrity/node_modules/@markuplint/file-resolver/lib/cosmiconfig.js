"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.load = exports.search = void 0;
const tslib_1 = require("tslib");
const path_1 = tslib_1.__importDefault(require("path"));
const cosmiconfig_1 = require("cosmiconfig");
const jsonc_1 = require("jsonc");
const explorer = (0, cosmiconfig_1.cosmiconfig)('markuplint', {
    loaders: {
        noExt: ((path, content) => {
            try {
                return jsonc_1.jsonc.parse(content);
            }
            catch (error) {
                if (error instanceof Error && error.name === 'JSONError') {
                    return cosmiconfig_1.defaultLoaders['noExt'](path, content);
                }
                throw error;
            }
        }),
    },
});
async function search(dir, cacheClear) {
    if (cacheClear) {
        explorer.clearCaches();
    }
    dir = path_1.default.dirname(dir);
    const result = await explorer.search(dir);
    if (!result || result.isEmpty) {
        return null;
    }
    return {
        filePath: result.filepath,
        config: result.config,
    };
}
exports.search = search;
async function load(filePath, cacheClear) {
    if (cacheClear) {
        explorer.clearCaches();
    }
    const result = await explorer.load(filePath);
    if (!result || result.isEmpty) {
        return null;
    }
    return {
        filePath: result.filepath,
        config: result.config,
    };
}
exports.load = load;
